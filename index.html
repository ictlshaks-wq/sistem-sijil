<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Janaan Sijil Pintar - JPN Pahang</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --primary-blue:#2c3e50;
      --gold-accent:#bc9355;
      --bg-light:#f4f7f6;
      --paper:#ffffff;
    }

    body{
      background:var(--bg-light);
      padding:20px 0;
      font-family:'Montserrat',sans-serif;
    }

    /* Kad input */
    .input-card{
      max-width:560px;
      background:#fff;
      padding:28px;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.10);
      margin:18px auto;
    }
    .form-label{ font-weight:800; color:var(--primary-blue); }

    /* Pratonton */
    #certificate-container{ display:none; margin-top:26px; }

    .cert-viewport{
      overflow:auto;
      background:#d1d5db;
      padding:18px 10px;
      border-radius:12px;
      display:flex;
      justify-content:center;
      box-shadow:inset 0 2px 10px rgba(0,0,0,.12);
    }

    /* =========================
       SIJIL A4 SEBENAR (mm)
       Tinggi 297mm x Lebar 210mm
       ========================= */
    #actual-certificate{
      width:210mm;
      height:297mm;
      background:var(--paper);
      position:relative;
      box-sizing:border-box;

      /* Border biru */
      border:10mm solid var(--primary-blue);

      /* susun kandungan */
      text-align:center;
      color:#333;
      display:flex;
      flex-direction:column;
    }

    /* Garis emas dalam (tidak kacau layout) */
    #actual-certificate::before{
      content:"";
      position:absolute;
      inset:6mm;
      border:1.2mm solid var(--gold-accent);
      pointer-events:none;
    }

    /* Kawasan kandungan (padding dalam sijil) */
    .cert-content{
      position:relative;
      z-index:2;
      height:100%;
      padding:18mm 16mm 16mm; /* ruang selesa */
      box-sizing:border-box;

      display:flex;
      flex-direction:column;
      justify-content:space-between;
      align-items:center;
    }

    /* Logo */
    .logo-box{
      display:flex;
      justify-content:center;
      align-items:center;
      margin-top:2mm;
      margin-bottom:2mm;
    }
    .logo-img{
      height:28mm; /* BESAR & stabil */
      width:auto;
      display:block;
      object-fit:contain;
    }

    /* Tajuk sijil */
    .cert-header-title{
      font-family:'Cinzel',serif;
      font-size:20mm;
      color:var(--gold-accent);
      letter-spacing:2mm;
      line-height:1.05;
      margin-top:2mm;
      margin-bottom:2mm;
    }

    .cert-body{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:4mm;
      width:100%;
    }

    .text-intro{ font-size:5mm; margin:0; }

    /* ===============================
       NAMA PESERTA: SAMA MACAM PROGRAM
       Font Cinzel + saiz sama + HITAM
       =============================== */
    .participant-name{
      font-family:'Cinzel',serif;
      font-weight:700;
      font-size:9mm;     /* sama dengan .program-name */
      color:#000;        /* HITAM */
      text-transform:uppercase;
      margin:2mm 0 1mm;
      width:100%;
    }

    .name-line{
      width:88%;
      height:0.6mm;
      background:var(--gold-accent);
      margin:0 auto 2mm;
      opacity:.95;
    }

    .program-name{
      font-family:'Cinzel',serif;
      font-weight:700;
      color:var(--primary-blue);
      font-size:9mm;     /* sama dengan participant */
      line-height:1.2;
      text-transform:uppercase;
      margin:2mm 0 1mm;
      padding:0 6mm;
    }

    .program-details{
      font-size:4.4mm;
      color:#555;
      margin-top:1mm;
    }

    /* Tandatangan */
    .signature-area{
      width:100%;
      display:flex;
      justify-content:flex-end;
      align-items:flex-end;
      margin-top:6mm;
    }
    .sigbox{
      width:70mm;
      text-align:center;
    }
    .signature-img{
      height:34mm;   /* BESARKAN TANDATANGAN */
      width:auto;
      display:block;
      object-fit:contain;
      margin:0 auto -4mm;
    }
    .signature-line{
      border-top:0.6mm solid #333;
      padding-top:3mm;
    }
    .signer-name{
      font-weight:800;
      font-size:4.6mm;
      text-transform:uppercase;
      margin-bottom:1mm;
    }
    .signer-title{
      font-size:3.8mm;
      color:#444;
      line-height:1.25;
    }

    /* Watermark */
    .watermark{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(-35deg);
      font-size:44mm;
      color:rgba(188,147,85,0.06);
      font-family:'Cinzel',serif;
      z-index:1;
      pointer-events:none;
      user-select:none;
      white-space:nowrap;
    }

    .spinner-border{ width:1.2rem; height:1.2rem; display:none; margin-right:8px; }
    .btn-success{ padding:12px 40px; font-weight:800; border-radius:10px; }

    /* Print betul-betul A4 */
    @page { size: A4 portrait; margin: 0; }
    @media print{
      body{ background:#fff; padding:0; }
      .input-card, .btn, .alert, hr, .text-muted{ display:none !important; }
      #certificate-container{ display:block !important; }
      .cert-viewport{ padding:0 !important; background:#fff !important; box-shadow:none !important; }
      #actual-certificate{ box-shadow:none !important; }
    }
  </style>
</head>

<body>
<div class="container">

  <!-- BORANG -->
  <div class="input-card">
    <h4 class="text-center mb-3" style="color:var(--primary-blue);">Sistem Sijil Digital JPN Pahang</h4>

    <div class="alert alert-info py-2 text-center small mb-3">
      Kod demo: <strong>DEMO123</strong>
    </div>

    <div id="statusMsg" class="small text-center mb-3" style="min-height:18px;color:#0f766e;"></div>

    <div class="mb-3">
      <label class="form-label">Nama Penuh Peserta</label>
      <input type="text" id="inputNama" class="form-control" placeholder="SEPERTI DALAM KAD PENGENALAN" />
    </div>

    <div class="mb-3">
      <label class="form-label">Nombor Kad Pengenalan</label>
      <input type="text" id="inputIC" class="form-control" placeholder="CONTOH: 010203060708" />
      <div class="form-text">Tip: boleh tanpa dash (-). Sistem paparkan seperti dimasukkan.</div>
    </div>

    <div class="mb-3">
      <label class="form-label text-danger">Kod Rahsia Program</label>
      <input type="text" id="inputKod" class="form-control" placeholder="Masukkan kod daripada penganjur" />
    </div>

    <button onclick="janaSijilSekarang()" id="btnJana"
      class="btn btn-primary w-100 py-2 d-flex align-items-center justify-content-center">
      <div class="spinner-border text-light" role="status" id="loading"></div>
      <span id="btnText">Semak & Jana Sijil</span>
    </button>
  </div>

  <!-- SIJIL -->
  <div id="certificate-container" class="text-center">
    <hr class="my-5">

    <div class="cert-viewport">
      <div id="actual-certificate" class="shadow-lg">
        <div class="watermark">RASMI</div>

        <div class="cert-content">
          <!-- LOGO -->
          <div>
            <div class="logo-box">
              <img src="./assets/logo.png" class="logo-img" alt="Logo JPN">
            </div>

            <div class="cert-header-title">SIJIL<br>PENYERTAAN</div>
          </div>

          <div class="cert-body">
            <p class="text-intro">Dengan penuh sukacita diperakui bahawa</p>

            <div class="participant-name" id="displayNama">NAMA PESERTA</div>
            <div class="name-line"></div>

            <p class="text-intro">No. K/P: <span id="displayIC">000000-00-0000</span></p>

            <div style="margin-top:4mm;">
              <div class="text-intro" style="font-size:4.8mm;">telah menyertai dengan jayanya program</div>
              <div class="program-name" id="displayProgram">NAMA PROGRAM</div>
              <div class="program-details" id="displayMeta">Tarikh | Masa | Tempat</div>
            </div>
          </div>

          <!-- TANDATANGAN -->
          <div class="signature-area">
            <div class="sigbox">
              <img src="./assets/sign.png" class="signature-img" alt="Tandatangan">
              <div class="signature-line">
                <div class="signer-name">PENGARAH PENDIDIKAN NEGERI PAHANG</div>
                <div class="signer-title">Jabatan Pendidikan Negeri Pahang</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="mt-4 mb-5 pb-5">
      <button onclick="downloadSijilPDF()" class="btn btn-success btn-lg shadow">
        MUAT TURUN SIJIL (PDF A4)
      </button>
      <p class="mt-3 text-muted small fst-italic">
        Nota: Pastikan fail imej berada di <b>./assets/logo.png</b> dan <b>./assets/sign.png</b>.
      </p>
    </div>
  </div>

</div>

<script>
  // DATA DEMO
  const dataDemo = [{
    kod: "DEMO123",
    program: "BENGKEL TRANSFORMASI DIGITAL & AI 2026",
    tarikh: "20 Januari 2026",
    masa: "8.30 Pagi - 4.30 Petang",
    tempat: "Pusat Konvensyen JPN Pahang"
  }];

  // Optional Apps Script
  const SCRIPT_URL = ""; // contoh: "https://script.google.com/macros/s/AKfycb.../exec";

  function setStatus(msg, color="#0f766e"){
    const el = document.getElementById("statusMsg");
    el.style.color = color;
    el.textContent = msg || "";
  }

  function normalizeKod(x){
    return (x || "").toString().trim().toUpperCase();
  }

  function basicICOk(ic){
    const clean = (ic || "").replace(/[^0-9]/g, "");
    return clean.length >= 8 && clean.length <= 14;
  }

  async function janaSijilSekarang(){
    const kod  = document.getElementById("inputKod").value.trim();
    const nama = document.getElementById("inputNama").value.trim();
    const ic   = document.getElementById("inputIC").value.trim();

    const btn = document.getElementById("btnJana");
    const spinner = document.getElementById("loading");
    const btnText = document.getElementById("btnText");

    if(!nama || !ic || !kod){
      alert("Sila lengkapkan Nama, IC dan Kod Program.");
      return;
    }
    if(!basicICOk(ic)){
      alert("Format IC nampak tidak sah. Sila semak semula.");
      return;
    }

    setStatus("");
    btn.disabled = true;
    spinner.style.display = "inline-block";
    btnText.textContent = "Menjana...";
    document.getElementById("certificate-container").style.display = "none";

    // DEMO
    if(normalizeKod(kod) === "DEMO123"){
      setTimeout(() => {
        const d = dataDemo[0];
        tampilkanSijil(
          nama, ic,
          d.program,
          `Tarikh: ${d.tarikh} | Masa: ${d.masa} | Tempat: ${d.tempat}`
        );
        btn.disabled = false;
        spinner.style.display = "none";
        btnText.textContent = "Semak & Jana Sijil";
        setStatus("Sijil demo berjaya dijana.");
      }, 250);
      return;
    }

    // REAL-TIME (Apps Script)
    try{
      if(!SCRIPT_URL){
        alert("Mod real-time belum diaktifkan. Guna kod DEMO123 untuk ujian, atau masukkan SCRIPT_URL.");
        setStatus("SCRIPT_URL kosong. Aktifkan Apps Script jika mahu mod real-time.", "#b45309");
        return;
      }

      setStatus("Menyemak kod program...");
      const url = `${SCRIPT_URL}?kod=${encodeURIComponent(kod)}`;
      const res = await fetch(url, { method:"GET", cache:"no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const out = await res.json();

      if(out && out.ok && out.program){
        const p = out.program;
        tampilkanSijil(
          nama, ic,
          p.nama_program || "NAMA PROGRAM",
          `Tarikh: ${p.tarikh || "-"} | Masa: ${p.masa || "-"} | Tempat: ${p.tempat || "-"}`
        );
        setStatus("Kod sah. Sijil berjaya dijana.");
      }else{
        alert((out && out.message) ? out.message : "Kod Rahsia tidak dijumpai.");
        setStatus("Kod tidak dijumpai.", "#b45309");
      }
    }catch(e){
      console.error(e);
      alert("Ralat sambungan / konfigurasi Apps Script.");
      setStatus("Ralat sambungan / konfigurasi Apps Script.", "#b91c1c");
    }finally{
      btn.disabled = false;
      spinner.style.display = "none";
      btnText.textContent = "Semak & Jana Sijil";
    }
  }

  function tampilkanSijil(nama, ic, program, meta){
    document.getElementById("displayNama").innerText = (nama || "").toUpperCase();
    document.getElementById("displayIC").innerText = ic || "";
    document.getElementById("displayProgram").innerText = (program || "").toUpperCase();
    document.getElementById("displayMeta").innerText = meta || "";

    document.getElementById("certificate-container").style.display = "block";
    window.scrollTo({ top: document.getElementById("certificate-container").offsetTop, behavior:"smooth" });
  }


</script>
</body>
</html>

